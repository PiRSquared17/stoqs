MAP
  IMAGETYPE PNG24
  EXTENT -125.817514 28.649011  -88.417199 36.901181
  SIZE 1024 1024
  IMAGECOLOR 255 255 255
  NAME 'MBARI STOQS'
  UNITS dd
  CONFIG "MS_ERRORFILE" "/tmp/mapserver_stoqshg.log"
  DEBUG 5
  # Not needed with mapserver 6.0.1 and default proj4 install
  ##CONFIG "PROJ_LIB" "/usr/local/Proj4/share/proj"
  WEB
    IMAGEPATH "/tmp"
    METADATA
          "wfs_title"       "{{ wfs_title }}"
          "wfs_onlineresource"   "http://{{ mapserver_host }}/cgi-bin/mapserv?map={{ mappath }}&" 
          "wfs_srs"         "EPSG:4326 EPSG:900913 "  
          "wfs_abstract"    "MBARI STOQS"
          "wfs_enable_request" "GetMap GetFeature GetFeatureInfo"
          "wms_title"       "MBARI_STOQS"
          "wms_onlineresource"   "http://{{ mapserver_host }}/cgi-bin/mapserv?map={{ mappath }}&" 
          "wms_srs"         "EPSG:4326 EPSG:900913 "  
          "wms_abstract"    "MBARI STOQS"
          "wms_feature_info_mime_type" "text/html"
          "wms_enable_request" "GetMap GetFeature GetFeatureInfo"
        END # METADATA
  END # WEB
  PROJECTION
    "init=epsg:4326"
  END # PROJECTION
  LAYER
    CONNECTIONTYPE POSTGIS
    CONNECTION "host={{ dbconn.HOST }} port={{ dbconn.PORT }} user={{ dbconn.USER }} password={{ dbconn.PASSWORD }} dbname={{ dbconn.NAME }}"
    DATA "{{ geo_query }}"

# gid and geom need to be alises
#    DATA "geom from (SELECT DISTINCT stoqs_activity.id as gid, stoqs_activity.uuid, stoqs_activity.campaign_id, stoqs_activity.platform_id, stoqs_activity.activitytype_id, stoqs_activity.name, stoqs_activity.comment, stoqs_activity.startdate, stoqs_activity.enddate, stoqs_activity.num_measuredparameters, stoqs_activity.loaded_date, stoqs_activity.maptrack as geom, stoqs_activity.mindepth, stoqs_activity.maxdepth, stoqs_platform.id, stoqs_platform.uuid, stoqs_platform.name, stoqs_platform.platformtype_id, stoqs_platformtype.id, stoqs_platformtype.uuid, stoqs_platformtype.name FROM stoqs_activity INNER JOIN stoqs_platform ON (stoqs_activity.platform_id = stoqs_platform.id) INNER JOIN stoqs_platformtype ON (stoqs_platform.platformtype_id = stoqs_platformtype.id)) as subquery using unique gid using srid=4326"

      DEBUG 2
      DUMP true
      TYPE line
      STATUS on
      METADATA
       "wfs_title"     "track_lines"    # Short description
       "wms_title"     "track_lines"    # Short description
       "wms_include_items"  "all"               # Include all attributes
       "gml_featureid"  "1"     # id is the primary key
       "gml_include_items"  "all"               # Include all attributes
       "wfs_abstract"       "Track Lines Activity Tracks."
    END # DATA
    PROJECTION
      "init=epsg:4326"
    END # PROJECTION
    TEMPLATE data.html
    HEADER header.html
    FOOTER footer.html
    NAME "track_lines"
    CLASS
      NAME "track_lines"
      STYLE
        COLOR 200 0 0
      END # STYLE
    END # CLASS
  END # LAYER

END # MAP

