<html xmlns="http://www.w3.org/1999/xhtml"> 
    <head> 
    <title>MBARI {{ dbName }} database</title> 
    <style type="text/css"> 
     #map { 
           width: 800px; 
           height: 800px; 
           border: 1px solid #eee;
          } 
    </style> 
    <script src="http://openlayers.org/api/OpenLayers.js"></script> 
    <script src="http://maps.google.com/maps?file=api&amp;v=2&amp;sensor=false&amp;key=ABQIAAAAhLglASsEZfvFQaft8M56aRSos6qZ3QRUd9b0x7ILnzlgcRShTBSwT-YKLw2TA-ysldiLElLNlvG4yw" type="text/javascript"></script>
    <script type="text/javascript">
      OpenLayers.IMAGE_RELOAD_ATTEMPTS = 4;
      OpenLayers.Util.onImageLoadError = function() {this.style.display="none"; };
      var map = null; 
      var tc_gulper_auv=null;
      function init() {
                var options = {
                            projection: new OpenLayers.Projection("EPSG:900913"),
                            displayProjection: new OpenLayers.Projection("EPSG:4326"),
                            units: "m",
                            maxResolution: 156543.0339,
                            maxExtent: new OpenLayers.Bounds(-20037508.34, -20037508.34,
                                                             20037508.34, 20037508.34)
                        };
                    map = new OpenLayers.Map('map',options);
                    var gphy = new OpenLayers.Layer.Google(
                        "Google Physical",
                        {'type': G_PHYSICAL_MAP,
                             'sphericalMercator': true}
                    );



            var gmap = new OpenLayers.Layer.Google(
                "Google Streets", // the default
                {'sphericalMercator': true}
            );
            var ghyb = new OpenLayers.Layer.Google(
                "Google Hybrid",
                {'type': G_HYBRID_MAP, 
                 'sphericalMercator': true}
            );
            var gsat = new OpenLayers.Layer.Google(
                "Google Satellite",
                {'type': G_SATELLITE_MAP, 
                 'sphericalMercator': true}
            );
            stoqs_test = new OpenLayers.Layer.WMS(
                    "Sample Track",
                    "http://{{ mapserver_host }}/cgi-bin/mapserv?map={{ mappath }}&",
                    { layers: 'Sample_Track',
                      transparent: 'True' },
                    { units: 'degrees',
                      //displayInLayerSwitcher: false,
                      projection: "EPSG:900913",
                      reproject: false,
                      visibility: false,
                      displayOutsideMaxExtent: true });
            map.addLayers([stoqs_test]);
            update_date();
            map.setCenter(new OpenLayers.LonLat(-13594478.3, 4411945.3), 9);
                    map.addControl(new OpenLayers.Control.LayerSwitcher());
                    map.addControl(new OpenLayers.Control.MousePosition());
                    map.addControl(new OpenLayers.Control.PanZoomBar());
                    map.events.register('click', map, function (e) {
                    OpenLayers.Util.getElement('nodeList').innerHTML = "Loading... please wait...";
                    var url =  gulper_auv.getFullRequestString({
                                    REQUEST: "GetFeatureInfo",
                                    EXCEPTIONS: "application/vnd.ogc.se_xml",
                                    BBOX: tc_gulper_auv.map.getExtent().toBBOX(),
                                    X: e.xy.x,
                                    Y: e.xy.y,
                                    FEATURE_COUNT: 1000,
                                    INFO_FORMAT: 'text/html',
                                    QUERY_LAYERS: stoqs_test.params.LAYERS,
                                    WIDTH: stoqs_test.map.size.w,
                                    HEIGHT: stoqs_test.map.size.h});
                    OpenLayers.loadURL(url, '', this, setHTML);
                    OpenLayers.Event.stop(e);
              });
             update_date();
      }
      function setHTML(response) {
              OpenLayers.Util.getElement('nodeList').innerHTML = response.responseText;
          }
      function update_date() {
          var string = OpenLayers.Util.getElement('year').value + "-" +
                       OpenLayers.Util.getElement('month').value + "-" +
                       OpenLayers.Util.getElement('day').value + "/" +
                       OpenLayers.Util.getElement('eyear').value + "-" +
                       OpenLayers.Util.getElement('emonth').value + "-" +
                       OpenLayers.Util.getElement('eday').value 

          tc_gulper_auv.mergeNewParams({'time':string});
          gulper_auv.mergeNewParams({'time':string});
      }
    </script> 
    </head> 
    <!-- Don't initialize the map until the body 
         has completed loading -->
    <body onload="init()"> 
        <input size="4" type='text' id='year' value="2010" onchange="update_date()"/>-<input size="2" type="text" id="month" value="08" onchange="update_date()"/>-<input size="2" type="text" id="day" value="29" onchange="update_date()" /> /
        <input size="4" type='text' id='eyear' value="2010" onchange="update_date()"/>-<input size="2" type="text" id="emonth" value="09" onchange="update_date()"/>-<input size="2" type="text" id="eday" value="29" onchange="update_date()" />

        <div id="map"></div> 
        <div> 
          <h1 style="font-size:1.3em;">Information</h1> 
          <p style="font-size:.8em;">Click a feature to see information about it below.</p> 
          <div id="nodeList"> 
        </div> 
    </div> 
    </body> 
    
</html> 

