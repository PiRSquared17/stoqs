MAP
  IMAGETYPE JPEG
  EXTENT -125.817514 28.649011  -88.417199 36.901181
  SIZE 1024 1024
  IMAGECOLOR 255 255 255
  NAME 'MBARI STOQS'
  UNITS dd
  CONFIG "MS_ERRORFILE" "/tmp/mapserver_stoqshg.log"
  DEBUG 5
  WEB
    IMAGEPATH "/dev/shm"
    METADATA
          "ows_enable_request"   "*"
          "wfs_title"       "{{ wfs_title }}"
          "wfs_onlineresource"   "http://{{ mapserver_host }}/cgi-bin/mapserv?map={{ mappath }}&" 
          "wfs_srs"         "EPSG:4326 EPSG:900913 "  
          "wfs_abstract"    "MBARI STOQS"
          "wfs_enable_request" "GetMap GetFeature GetFeatureInfo"
          "wms_title"       "MBARI_STOQS"
          "wms_onlineresource"   "http://{{ mapserver_host }}/cgi-bin/mapserv?map={{ mappath }}&" 
          "wms_srs"         "EPSG:4326 EPSG:900913 "  
          "wms_abstract"    "MBARI STOQS"
          "wms_feature_info_mime_type" "text/html"
          "wms_enable_request" "GetMap GetFeature GetFeatureInfo"
    END # METADATA
  END # WEB
  PROJECTION
    "init=epsg:4326"
  END # PROJECTION

  SYMBOL
    NAME "circle"
    TYPE ellipse 
    POINTS
      1 1
    END # POINTS
    FILLED true
  END # SYMBOL

  LAYER
    NAME "copyright"
    STATUS ON
    TYPE annotation
    TRANSFORM ll                    #set the image origin to be lower left
    FEATURE
      POINTS
        60 -10                      #set the offset from lower left position in pixels
      END
      TEXT "Â© {{ copyright_string }}" 
    END
    CLASS
      LABEL                         #defines the font, colors etc. of the text
        FONT "sans"
        TYPE TRUETYPE
        SIZE 8
        BUFFER 1
        COLOR 0 0 0
        FORCE TRUE
        STYLE                       # new in mapserver 6
          GEOMTRANSFORM 'labelpoly'
          COLOR 255 255 255
        END # STYLE
      END
    END
    UNITS PIXELS                    #sets the units for the feature object
  END

  # Union layer needs to have an empty CLASS section for it to draw the connected layer
  LAYER
    NAME "track_lines"
    TYPE line
    STATUS off
    TEMPLATE fooOnlyForWMSGetFeatureInfo
    CONNECTIONTYPE UNION
    CONNECTION "{{ union_layer_string|safe }}"
    STYLEITEM "AUTO"
    CLASS
    END
    PROJECTION
      "init=epsg:4326"
    END # PROJECTION
  END # LAYER
  {% for item in list %}
  {% if item.geo_query %}
  LAYER
    NAME "{{ item.name }}"
    TYPE {{ item.type }}
    DUMP true
    CONNECTIONTYPE POSTGIS
    CONNECTION "host={{ dbconn.HOST }} port={{ dbconn.PORT }} user={{ dbconn.USER }} password={{ dbconn.PASSWORD }} dbname={{ dbconn.NAME }}"
    DATA "{{ item.geo_query|safe }}"
    ##DEBUG 2
    METADATA
       "ows_title"     "{{ item.name }}"    # Short description
    END # METADATA
    STATUS off
    PROJECTION
      "init=epsg:4326"
    END # PROJECTION
    ##TEMPLATE "{{ STATIC_ROOT }}/wfs/sample_points_data.html"
    ##HEADER "{{ STATIC_ROOT }}/wfs/sample_points_header.html"
    ##FOOTER "{{ STATIC_ROOT }}/wfs/sample_points_footer.html"
    CLASS
      NAME "{{ item.name }}"
      STYLE
        COLOR {{ item.color|safe }}
        {{ item.extra_style|safe }}
      END # STYLE
    END # CLASS
  END # LAYER
  {% endif %}
  {% endfor %}

LAYER
   NAME 'sensortracks'
   TYPE POINT
   STATUS off

   CONNECTIONTYPE OGR
   ##CONNECTION '/home/mccann/dev/stoqshg/northsouth.kml'
   ##CONNECTION "http://172.16.130.135:8000/stoqs_dorado2011_s100/measuredparameter.kmln?parameter__name=fl700_uncorr&measurement__instantpoint__timevalue__gt=2011-03-15%2021:41:49&measurement__instantpoint__timevalue__lt=2011-03-16%2013:46:05&measurement__depth__gte=-0.12&measurement__depth__lte=18.12&&cmin=0.0000757&cmax=0.0023"

   CONNECTION "/mnt/hgfs/mccann/Downloads/dorado Points.kml"

   ##CONNECTION "{{ mp_kml|safe }}"

   ##TRANSPARENCY 50
   DEBUG 5

   PROJECTION
      "init=epsg:4326"
   ##'proj=longlat'
   ##'datum=WGS84'
   ##'no_defs'
   END

   METADATA
     'wms_title'           'doradopoints'
     'wms_name'            'doradopoints'
     'wms_onlineresource'  'http://ubuntu/cgi-bin/mapserv?map=/home/stoqsadm/deployed/mapfiles/proxy.map'
     'wms_server_version'  '1.1.0'
     'wms_srs'             'EPSG:4326'
     'wms_format'          'image/png'
   ##  'wms_transparent'     'true'
   END
    CLASS
      NAME "sensortracks_color"
      STYLE
        COLOR 244 244 16
        OUTLINECOLOR 199 199 199
      END # STYLE
    END # CLASS

END # LAYER

END # MAP

