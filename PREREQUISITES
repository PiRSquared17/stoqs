# PREREQUISITES 
# =============

# These commands need to be executed once on your system, they have been tested on CentOS 6.
# It is assumed that Postgres 9.1 is already installed.  A production environment will most
# likely have all of these packages installed.  Check with your system administrator to be 
# sure.

su -c "easy_install virtualenv"
su -c "yum -y install rabbitmq-server gdal scipy mod_wsgi"
su -c "/sbin/chkconfig rabbitmq-server on"
su -c "/sbin/service rabbitmq-server start"
su -c "rabbitmqctl add_user stoqs stoqs"		# Note: You may want different credentials
su -c "rabbitmqctl add_vhost stoqs"				# for the Rabbitmq account - here we use 'stoqs'.
su -c 'rabbitmqctl set_permissions -p stoqs stoqs ".*" ".*" ".*"'

# For ability to generate ER diagrams
su -c "yum -y install graphviz-devel"
su -c "yum -y install graphviz-python"


# Build GDAL from source.  Download latest (v1.9 or higher) tar ball from http://download.osgeo.org/gdal/
# Unpack, and in the top level directory (e.g. gdal-1.9.0/) run:
./configure --with-python
make
make install

# Install MapServer folling the instructions for your system at http://mapserver.org/.  It is typical to
# build it from source and then copy the 'mapserv' executable to the cgi-bin directory for your web server.
# The .map templates assume that this is where the mapserv executable is located.  You will set the MapServer
# host name for your privateSettings file.  It _can_ be a separate server from your Django server, but it must
# be able to see the .map files produced by Django through a network mount or some other mechanism.


# Go to the directory where you have checked out the stoqs project, e.g.:

cd ~/dev/stoqshg

# Instructions below are for setting up a development or "sandbox" environment.  If you are running 
# in a production environment where you have system admin support then it's likely that all of 
# these Python libraries have been installed at the system level and you will not need to create
# the venv-stoqs virtual environment with these packages, though you may find it convenient to run
# the virtual environment regargless.
 
# Create a venv for a development environment
virtualenv venv-stoqs
source venv-stoqs/bin/activate, (source venv-stoqs/bin/activate.csh if using csh or tcsh)

# Install additional Python packages required by STOQS:
easy_install numpy
easy_install paste
easy_install pydap
easy_install django==1.3
easy_install django-celery
easy_install coards
easy_install seawater
export PATH=/usr/pgsql-9.1/bin:$PATH
easy_install gdal
easy_install psycopg2==2.4.1
easy_install pygraphviz
easy_install django_extensions

# When running django-admin.py or 'python manage.py' do it in your virtualenv, making
# sure you prompt looks something like "(venv-stoqs)[student@localhost stoqsproj]$ "
# Proceed to the instructions in the INSTALL file.

--
Mike McCann
MBARI 1 February 2012


